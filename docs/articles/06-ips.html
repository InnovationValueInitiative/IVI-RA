<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Run the IPS">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iviRA</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../articles/how-to-contribute.html">Collaborate</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/InnovationValueInitiative/IVI-RA/blob/master/vignettes/06-ips.Rmd"><code>vignettes/06-ips.Rmd</code></a></small>
      <div class="hidden name"><code>06-ips.Rmd</code></div>

    </div>

    
    
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, txseq <span class="op">:</span><span class="er">=</span><span class="st"> "Sequence 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, txseq <span class="op">:</span><span class="er">=</span><span class="st"> "Sequence 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(sim.out1, sim.out2)
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx line tx_cycle death      age        ttd acr eular
## 1:     1   1  1     6  4    1        1     0 49.84687  0.0000000   0     0
## 2:     1   1  1    12 13    2        1     0 50.34687  1.1540831   3     1
## 3:     1   1  1    18 13    2        2     0 50.84687  0.1540831   3     1
## 4:     1   1  1    24 13    2        3     0 51.34687 -0.8459169   3     1
## 5:     1   1  1    30 18    3        1     0 51.84687 69.2988412   0     1
## 6:     1   1  1    36 18    3        2     0 52.34687 68.2988412   0     1
##    das28 sdai cdai      haq     ttsi si yrlen  tx_cost hosp_days hosp_cost
## 1:    NA   NA   NA 1.443428 126.4363  0   0.5 25830.03 0.3049917  429.8086
## 2:    NA   NA   NA 1.118326 116.7123  0   0.5 24899.03 0.3049917  429.8086
## 3:    NA   NA   NA 1.110336 115.7123  0   0.5 24899.03 0.3049917  429.8086
## 4:    NA   NA   NA 1.416580 114.7123  0   0.5 24899.03 0.3049917  429.8086
## 5:    NA   NA   NA 1.091478  71.5888  0   0.5 13775.80 0.3049917  429.8086
## 6:    NA   NA   NA 1.085430  70.5888  0   0.5 19375.69 0.3049917  429.8086
##    mgmt_cost si_cost prod_loss   utility      qalys      txseq
## 1:  213.6983       0  4213.829 0.7185028 0.35925139 Sequence 1
## 2:  213.6983       0  3264.752 0.7136521 0.35682605 Sequence 1
## 3:  213.6983       0  3241.426 1.0000000 0.50000000 Sequence 1
## 4:  213.6983       0  4135.448 0.1733729 0.08668645 Sequence 1
## 5:  213.6983       0  3186.372 0.8268782 0.41343909 Sequence 1
## 6:  213.6983       0  3168.717 0.1898230 0.09491150 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sim.out1.summary<span class="op">$</span>means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 19.525 13.29338       1.3525       18.1725        0
## 2:     1   2 19.800 13.56440       1.2150       18.5850        0
## 3:     1   3 20.475 13.90775       1.2625       19.2125        0
## 4:     1   4 21.170 14.53485       1.5125       19.6575        0
## 5:     1   5 22.005 14.67130       1.3350       20.6700        0
## 6:     1   6 16.790 12.09503       0.9900       15.8000        0
##          dhaq   si     qalys   dqalys  tx_cost dtx_cost hosp_days
## 1: 0.18712426 0.26 10.262908 7.152354 463498.7 360019.5  15.99079
## 2: 0.12057788 0.20 10.792507 7.514815 442710.6 339818.3  16.03915
## 3: 0.10641342 0.17 11.646163 8.097517 425032.1 332217.6  13.57745
## 4: 0.31037336 0.26 10.587122 7.550120 463604.4 360344.3  27.77616
## 5: 0.09351525 0.16 12.346799 8.445869 478687.4 374574.7  19.32301
## 6: 0.25110862 0.17  8.649115 6.343089 329535.6 272107.2  13.27179
##    hosp_cost dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1:  21314.99   13335.60  8344.918   5681.545 1762.1620 1288.3519  141482.6
## 2:  24511.20   16794.10  8096.845   5546.910 1398.1803 1023.7696  133605.0
## 3:  18233.87   12795.23  8060.424   5475.084  994.8754  701.5489  179352.7
## 4:  38288.19   24405.66  9495.565   6519.445 1547.6906 1277.8669  196768.8
## 5:  28986.38   17413.67  9637.182   6425.357 1102.9894  842.6168  222860.7
## 6:  20409.22   14190.70  6785.452   4888.043  826.2197  660.9843  124984.1
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:   93528.24 380325.0  473853.3           24.57639  0.2873988
## 2:   89170.95 363183.1  452354.1           25.07969  0.2986760
## 3:  116146.61 351189.5  467336.1           25.19834  0.3255651
## 4:  128582.14 392547.3  521129.4           25.35939  0.3047764
## 5:  140697.64 399256.3  539953.9           25.14687  0.3389818
## 6:   87709.45 291846.9  379556.3           25.35094  0.2522893
##    dhc_cost_ann dprod_loss_ann
## 1:     15519.67       3729.357
## 2:     14477.08       3524.583
## 3:     14510.86       4599.598
## 4:     16116.13       5155.390
## 5:     16521.01       5579.099
## 6:     11781.11       3470.203</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sim.out1.summary<span class="op">$</span>time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys      haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2813569 1.198226 25830.03  398.2340  213.6983
## 2:     1   1    12    97 0.2679136 1.147984 25522.90  407.7391  213.6983
## 3:     1   1    18    96 0.2827968 1.106899 23993.52  379.2144  213.6983
## 4:     1   1    24    94 0.2958422 1.093639 23282.47  355.0465  213.6983
## 5:     1   1    30    93 0.2886165 1.091556 21576.11  362.3822  213.6983
## 6:     1   1    36    92 0.3006256 1.102462 20520.81  367.6719  213.6983
##      si_cost prod_loss
## 1: 135.55093  3498.006
## 2:   0.00000  3351.332
## 3:  70.59944  3231.392
## 4:  72.10156  3192.683
## 5:  72.87684  3186.602
## 6:   0.00000  3218.440</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sim.out1.summary<span class="op">$</span>out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular        ttd      ttsi
## 1:     1   1  1  4   0     0   0.000000  9.789617
## 2:     1   1  1 13   0     0   0.000000 67.856535
## 3:     1   1  1 18   1     1 104.090799 14.915593
## 4:     1   1  2  4   0     0   0.000000  5.536752
## 5:     1   1  2 13   1     1   1.122873 21.529146
## 6:     1   1  2 18   0     0   0.000000  6.164344</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeroen P. Jansen, Devin Incerti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
