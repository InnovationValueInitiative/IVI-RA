<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Run the IPS">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iviRA</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../articles/how-to-contribute.html">Collaborate</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/InnovationValueInitiative/IVI-RA/blob/master/vignettes/06-ips.Rmd"><code>vignettes/06-ips.Rmd</code></a></small>
      <div class="hidden name"><code>06-ips.Rmd</code></div>

    </div>

    
    
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, txseq <span class="op">:</span><span class="er">=</span><span class="st"> "Sequence 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, txseq <span class="op">:</span><span class="er">=</span><span class="st"> "Sequence 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx line tx_cycle death      age       ttd acr eular
## 1:     1   1  1     6  3    1        1     0 49.43622 12.982301   0     1
## 2:     1   1  1    12  3    1        2     0 49.93622 11.982301   0     1
## 3:     1   1  1    18  3    1        3     0 50.43622 10.982301   0     1
## 4:     1   1  1    24  3    1        4     0 50.93622  9.982301   0     1
## 5:     1   1  1    30  3    1        5     0 51.43622  8.982301   0     1
## 6:     1   1  1    36  3    1        6     0 51.93622  7.982301   0     1
##    das28 sdai cdai      haq     ttsi si yrlen  tx_cost hosp_days hosp_cost
## 1:    NA   NA   NA 1.431665 139.9466  0   0.5 20903.76 0.1401969  172.8017
## 2:    NA   NA   NA 1.427322 138.9466  0   0.5 20903.76 0.1401969  172.8017
## 3:    NA   NA   NA 1.422980 137.9466  0   0.5 20903.76 0.1401969  172.8017
## 4:    NA   NA   NA 1.418638 136.9466  0   0.5 20903.76 0.1401969  172.8017
## 5:    NA   NA   NA 1.414295 135.9466  0   0.5 20903.76 0.1401969  172.8017
## 6:    NA   NA   NA 1.409953 134.9466  0   0.5 20903.76 0.1401969  172.8017
##    mgmt_cost si_cost prod_loss   utility      qalys      txseq
## 1:  180.0968       0  4719.724 0.5971431 0.29857156 Sequence 1
## 2:  180.0968       0  4705.408 0.6357343 0.31786715 Sequence 1
## 3:  180.0968       0  4691.092 0.6341664 0.31708321 Sequence 1
## 4:  180.0968       0  4676.777 0.6894384 0.34471921 Sequence 1
## 5:  180.0968       0  4662.461 0.5915446 0.29577228 Sequence 1
## 6:  180.0968       0  4648.145 0.1065019 0.05325096 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw">head</span>(sim.out1.summary<span class="op">$</span>means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 20.895 14.09810       1.0400       19.8550        0
## 2:     1   2 20.885 14.17093       1.1525       19.7325        0
## 3:     1   3 20.355 13.91551       0.9250       19.4300        0
## 4:     1   4 19.150 13.48714       0.6825       18.4675        0
## 5:     1   5 21.085 14.30082       1.2275       19.8575        0
## 6:     1   6 21.350 14.65675       1.6775       19.6725        0
##          dhaq   si    qalys   dqalys  tx_cost dtx_cost hosp_days hosp_cost
## 1: 0.10587768 0.26 11.35006 7.831600 437681.3 333365.8 10.738665  12461.68
## 2: 0.29679059 0.22 10.54195 7.521116 379215.8 303640.8 13.605340  17981.94
## 3: 0.27222085 0.23 10.83045 7.687801 369215.8 302111.8 10.846623  14160.47
## 4: 0.07801418 0.17 10.82399 7.723904 434832.4 334769.1  8.837646  11778.25
## 5: 0.19359357 0.15 11.40913 7.984962 466395.1 356547.5 10.998807  13810.31
## 6: 0.14586573 0.28 11.72070 8.164887 495979.5 383364.2 19.867598  28330.36
##    dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1:   7650.772  7526.247   5078.045 1652.3335 1206.1992  166015.5
## 2:  10601.706  7769.914   5272.057 1427.1379 1083.7476  200557.6
## 3:   8375.257  7838.644   5358.817 1418.4949 1089.8306  210545.0
## 4:   7888.793  7422.638   5227.683 1065.7569  817.1346  157897.1
## 5:   8124.581  7921.401   5372.659  877.7412  649.8134  199585.9
## 6:  18561.784  8469.510   5814.308 1326.7902  996.6037  100278.5
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:  107718.86 347300.8  455019.7           21.85011  0.3105838
## 2:  126995.33 320598.3  447593.6           22.29601  0.3012485
## 3:  136062.00 316935.8  452997.8           22.49813  0.3081736
## 4:  108624.55 348702.7  457327.2           21.60991  0.3079992
## 5:  129374.66 370694.6  500069.3           21.66821  0.3181279
## 6:   67101.71 408736.9  475838.6           21.88356  0.3268039
##    dhc_cost_ann dprod_loss_ann
## 1:     14051.53       4251.623
## 2:     13215.93       5024.046
## 3:     13045.73       5419.896
## 4:     14132.04       4311.842
## 5:     15000.58       5123.857
## 6:     16609.79       2699.484</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary<span class="op">$</span>time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys      haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2829719 1.146948 20903.76  253.4783  180.0968
## 2:     1   1    12    97 0.2862925 1.058111 21002.36  217.8435  180.0968
## 3:     1   1    18    95 0.2815945 1.068854 20202.25  227.3757  180.0968
## 4:     1   1    24    95 0.2982769 1.074813 18782.95  229.5153  180.0968
## 5:     1   1    30    95 0.2745592 1.121349 18355.88  228.3262  180.0968
## 6:     1   1    36    94 0.2920960 1.059242 17112.73  221.2133  180.0968
##      si_cost prod_loss
## 1:  63.55129  3781.105
## 2:  65.51679  3488.239
## 3:  66.89609  3523.658
## 4: 133.79219  3543.302
## 5:   0.00000  3696.714
## 6:   0.00000  3491.971</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary<span class="op">$</span>out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular        ttd         ttsi
## 1:     1   1  1  3   1     2  3.0977332 5.130062e+01
## 2:     1   1  1  5   2     2 47.4728565 1.898929e+01
## 3:     1   1  1  8   1     2  0.5384596 2.110232e+02
## 4:     1   1  1 14   0     0  0.0000000 5.457277e+09
## 5:     1   1  2  3   3     2  3.1130602 2.722444e+01
## 6:     1   1  2  5   0     0  0.0000000 3.018634e+01</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
