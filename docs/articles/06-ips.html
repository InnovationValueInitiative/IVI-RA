<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Run the IPS">
<meta property="og:description" content="iviRA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iviRA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../articles/how-to-contribute.html">Collaborate</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://ivi-ra-expert.clarityviz.com/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://ivi-ra.clarityviz.com/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="06-ips_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Run the IPS</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/InnovationValueInitiative/IVI-RA/blob/master/vignettes/06-ips.Rmd"><code>vignettes/06-ips.Rmd</code></a></small>
      <div class="hidden name"><code>06-ips.Rmd</code></div>

    </div>

    
    
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">sim.out1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="kw">tx_seqs</span> <span class="kw">=</span> <span class="no">txseq1</span>, <span class="kw">input_data</span> <span class="kw">=</span> <span class="no">input.dat</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="no">parsamp</span>,
                     <span class="kw">model_structures</span> <span class="kw">=</span> <span class="no">mod.structs</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"data"</span>)
<span class="no">sim.out1</span>[, <span class="no">txseq</span> <span class="kw">:=</span> <span class="st">"Sequence 1"</span>]
<span class="no">sim.out2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="kw">tx_seqs</span> <span class="kw">=</span> <span class="no">txseq2</span>, <span class="kw">input_data</span> <span class="kw">=</span> <span class="no">input.dat</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="no">parsamp</span>,
                     <span class="kw">model_structures</span> <span class="kw">=</span> <span class="no">mod.structs</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"data"</span>)
<span class="no">sim.out2</span>[, <span class="no">txseq</span> <span class="kw">:=</span> <span class="st">"Sequence 2"</span>]
<span class="no">sim.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">sim.out1</span>, <span class="no">sim.out2</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim.out</span>)</pre></body></html></div>
<pre><code>##    model sim id month tx line tx_cycle death     age ttd acr eular das28 sdai
## 1:     1   1  1     6  4    1        1     0 43.3534   0   0     0    NA   NA
## 2:     1   1  1    12 13    2        1     0 43.8534   0   0     0    NA   NA
## 3:     1   1  1    18 18    3        1     0 44.3534   0   0     1    NA   NA
## 4:     1   1  1    24 21    4        1     0 44.8534  NA   0     0    NA   NA
## 5:     1   1  1    30 21    4        2     0 45.3534  NA   0     0    NA   NA
## 6:     1   1  1    36 21    4        3     0 45.8534  NA   0     0    NA   NA
##    cdai      haq       ttsi si yrlen  tx_cost  hosp_days hosp_cost mgmt_cost
## 1:   NA 1.077919 74.3688906  0   0.5 25677.05 0.04361603   53.2399   200.632
## 2:   NA 1.077919 51.7041400  0   0.5 25787.57 0.04361603   53.2399   200.632
## 3:   NA 1.077919 -0.2198302  1   0.5 13566.21 0.04361603   53.2399   200.632
## 4:   NA 1.077919         NA  0   0.5     0.00 0.04361603   53.2399   200.632
## 5:   NA 1.090083         NA  0   0.5     0.00 0.04361603   53.2399   200.632
## 6:   NA 1.102248         NA  0   0.5     0.00 0.04361603   53.2399   200.632
##     si_cost prod_loss   utility     qalys      txseq
## 1:    0.000  3476.205 0.6194270 0.3097135 Sequence 1
## 2:    0.000  3476.205 0.6746809 0.3373405 Sequence 1
## 3: 5828.387  3476.205 0.5816696 0.2908348 Sequence 1
## 4:    0.000  3476.205 0.7315065 0.3657532 Sequence 1
## 5:    0.000  3515.435 0.6948181 0.3474091 Sequence 1
## 6:    0.000  3554.665 0.7378867 0.3689434 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">sim.out1.summary</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="kw">tx_seqs</span> <span class="kw">=</span> <span class="no">txseq1</span>, <span class="kw">input_data</span> <span class="kw">=</span> <span class="no">input.dat</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="no">parsamp</span>,
                     <span class="kw">model_structures</span> <span class="kw">=</span> <span class="no">mod.structs</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"summary"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim.out1.summary</span>$<span class="no">means</span>)</pre></body></html></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral         dhaq
## 1:     1   1 17.280 12.32665       1.2125       16.0675        0 0.0006495353
## 2:     1   2 18.670 13.04274       0.8425       17.8275        0 0.2176500537
## 3:     1   3 21.710 14.72577       0.9950       20.7150        0 0.1534472600
## 4:     1   4 18.555 13.03788       1.1950       17.3600        0 0.2350852170
## 5:     1   5 21.285 14.36844       0.8800       20.4050        0 0.1618301165
## 6:     1   6 20.405 14.22396       1.3700       19.0350        0 0.2061274112
##      si     qalys   dqalys  tx_cost dtx_cost hosp_days hosp_cost dhosp_cost
## 1: 0.21 10.138639 7.305116 419529.6 338984.7  9.302219  12264.16   8534.434
## 2: 0.18 10.324411 7.404151 396759.9 323448.2 12.449071  19314.08  12778.542
## 3: 0.15 11.964770 8.301409 489462.4 371444.0 12.881430  16760.62  10179.849
## 4: 0.21  9.692416 6.938441 425842.8 337641.3 17.684147  27303.58  18263.696
## 5: 0.19 11.864767 8.146216 501646.0 375461.3 12.273989  15429.11   9424.074
## 6: 0.16 11.286624 8.003576 403544.0 327233.1 11.382186  14237.05   9341.970
##    mgmt_cost dmgmt_cost   si_cost dsi_cost prod_loss dprod_loss dhc_cost
## 1:  6933.842   4946.239 1223.9612 976.2811  118144.7   81850.07 353441.7
## 2:  7642.814   5339.218 1020.4173 760.2139  100418.5   66965.09 342326.1
## 3:  8735.543   5925.269  973.9373 753.2874  141833.6   92868.19 388302.4
## 4:  7738.937   5437.850 1104.8116 889.8004  132833.2   90675.32 362232.6
## 5:  8891.757   6002.383 1105.5056 814.2630  203575.0  132800.06 391702.0
## 6:  8510.791   5932.721 1053.4834 775.4057  124300.4   84151.87 343283.2
##    dtot_cost yrs_since_approval dqalys_ann dhc_cost_ann dprod_loss_ann
## 1:  435291.7           24.46814  0.2913079     14437.46       3253.503
## 2:  409291.2           25.26292  0.2969248     14173.54       2672.818
## 3:  481170.6           25.74134  0.3373858     15910.96       3771.957
## 4:  452907.9           25.03339  0.2777827     14723.16       3666.653
## 5:  524502.1           25.27431  0.3250496     15843.80       5366.227
## 6:  427435.1           26.30646  0.3246470     14419.52       3413.996</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim.out1.summary</span>$<span class="no">time.means</span>)</pre></body></html></div>
<pre><code>##    model sim month alive     qalys       haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2759053 1.1274530 25677.05  380.6109   200.632
## 2:     1   1    12   100 0.2902732 1.0606273 25720.15  355.2883   200.632
## 3:     1   1    18    99 0.3162868 0.9561812 23509.69  321.6509   200.632
## 4:     1   1    24    97 0.3080103 0.9611890 23528.15  348.1272   200.632
## 5:     1   1    30    96 0.3150940 0.9673393 21860.28  343.8836   200.632
## 6:     1   1    36    93 0.2909051 0.9830602 19549.08  340.2044   200.632
##      si_cost prod_loss
## 1: 116.56774  3635.949
## 2:  58.28387  3420.442
## 3:   0.00000  3083.611
## 4:  60.08646  3099.761
## 5:  60.71236  3119.595
## 6:  62.67083  3170.294</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim.out1.summary</span>$<span class="no">out0</span>)</pre></body></html></div>
<pre><code>##    model sim id tx acr eular       ttd         ttsi
## 1:     1   1  1  4   3     2 0.9881945 2.719131e+01
## 2:     1   1  1 13   0     0 0.0000000 8.268318e+01
## 3:     1   1  1 18   1     1 3.8057663 6.473289e+00
## 4:     1   1  1 21   0     0 0.0000000 4.925037e+10
## 5:     1   1  2  4   1     0 0.0000000 4.753752e+01
## 6:     1   1  2 13   2     0 0.0000000 4.304939e+01</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeroen P. Jansen, Devin Incerti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
