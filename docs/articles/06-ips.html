<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Collaborate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/how-to-contribute.html">How to contribute</a>
    </li>
    <li>
      <a href="../articles/suggested-improvements.html">Suggested improvements</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, txseq :<span class="er">=</span><span class="st"> "Sequence 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, txseq :<span class="er">=</span><span class="st"> "Sequence 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx line tx_cycle death      age       ttd acr eular
## 1:     1   1  1     6  3    1        1     0 48.79725  0.000000   0     0
## 2:     1   1  1    12  5    2        1     0 49.29725 11.217493   1     2
## 3:     1   1  1    18  5    2        2     0 49.79725 10.217493   1     2
## 4:     1   1  1    24  5    2        3     0 50.29725  9.217493   1     2
## 5:     1   1  1    30  5    2        4     0 50.79725  8.217493   1     2
## 6:     1   1  1    36  5    2        5     0 51.29725  7.217493   1     2
##    das28 sdai cdai       haq     ttsi si yrlen tx_cost  hosp_days
## 1:    NA   NA   NA 1.1828297 58.68553  0   0.5 22540.9 0.44889417
## 2:    NA   NA   NA 0.4815344 15.67744  0   0.5 21930.0 0.01551658
## 3:    NA   NA   NA 0.4726954 14.67744  0   0.5 21930.0 0.01551658
## 4:    NA   NA   NA 0.4638564 13.67744  0   0.5 21930.0 0.01551658
## 5:    NA   NA   NA 0.4550174 12.67744  0   0.5 21930.0 0.01551658
## 6:    NA   NA   NA 0.4461784 11.67744  0   0.5 21930.0 0.01551658
##    hosp_cost mgmt_cost si_cost prod_loss   utility     qalys      txseq
## 1: 656.51650  187.0969       0 2592.5139 0.7205659 0.3602830 Sequence 1
## 2:  19.97251  187.0969       0 1055.4220 0.2859512 0.1429756 Sequence 1
## 3:  19.97251  187.0969       0 1036.0488 0.7056680 0.3528340 Sequence 1
## 4:  19.97251  187.0969       0 1016.6756 0.7756173 0.3878086 Sequence 1
## 5:  19.97251  187.0969       0  997.3023 0.6368710 0.3184355 Sequence 1
## 6:  19.97251  187.0969       0  977.9291 0.6434224 0.3217112 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw">head</span>(sim.out1.summary$means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 21.085 14.30077       1.2350       19.8500        0
## 2:     1   2 20.260 13.95080       1.4900       18.7700        0
## 3:     1   3 21.730 14.73540       1.4875       20.2425        0
## 4:     1   4 21.220 14.57924       1.5000       19.7200        0
## 5:     1   5 19.705 13.48826       1.0525       18.6525        0
## 6:     1   6 20.460 14.18756       1.2475       19.2125        0
##          dhaq   si    qalys   dqalys  tx_cost dtx_cost hosp_days hosp_cost
## 1: 0.07573617 0.16 12.29632 8.493743 403576.9 313637.5 10.716923  14667.48
## 2: 0.10223423 0.17 11.77786 8.219077 362875.6 287079.3 16.232520  17758.40
## 3: 0.08895555 0.21 12.55330 8.700514 453761.4 348001.0  8.638051  11126.00
## 4: 0.23740364 0.18 11.28340 7.931935 370396.7 290450.2 26.503918  33247.29
## 5: 0.17927551 0.18 11.45430 8.035724 403937.9 317197.1 11.806307  15767.34
## 6: 0.22952658 0.13 11.56935 8.265110 387238.3 307465.6  9.824894  11705.95
##    dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1:   9326.573  7889.875   5351.257  941.2085  710.3083 102467.82
## 2:  12243.760  8130.043   5598.254 1160.4845  886.3505 104288.84
## 3:   6916.319  8369.861   5675.712 1432.2397 1087.1357 148566.56
## 4:  21813.773  8066.202   5541.898  919.0098  776.7511 108988.78
## 5:   9806.199  8446.967   5782.031 1036.8684  729.0094  82775.04
## 6:   7014.981  7834.381   5432.588  829.6275  578.0565 152479.76
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:   66721.67 329025.7  395747.3          -934.9484  0.3339814
## 2:   69761.72 305807.6  375569.3         -1011.3708  0.3232264
## 3:   96404.06 361680.2  458084.3          -913.7224  0.3443088
## 4:   71882.50 318582.6  390465.1         -1015.2020  0.3157790
## 5:   54330.12 333514.4  387844.5          -892.9473  0.3147369
## 6:  100465.62 320491.3  420956.9          -915.1304  0.3303036
##    dhc_cost_ann dprod_loss_ann
## 1:     13152.34       2619.424
## 2:     12290.38       2725.489
## 3:     14429.53       3804.972
## 4:     12848.44       2827.562
## 5:     13197.07       2125.526
## 6:     13050.07       3957.855</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys       haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2871432 1.0774522 22540.90  297.3753  187.0969
## 2:     1   1    12    98 0.2990008 1.0127442 22291.55  274.7867  187.0969
## 3:     1   1    18    98 0.3243857 0.9631137 20615.65  246.3731  187.0969
## 4:     1   1    24    96 0.3033779 0.9628405 19845.25  281.9005  187.0969
## 5:     1   1    30    95 0.3119615 0.9549574 18453.49  263.4533  187.0969
## 6:     1   1    36    92 0.3055176 0.9558423 17255.15  272.0442  187.0969
##     si_cost prod_loss
## 1: 58.82553  2361.549
## 2:  0.00000  2219.722
## 3: 60.02605  2110.943
## 4: 61.27659  2110.344
## 5:  0.00000  2093.066
## 6:  0.00000  2095.005</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular      ttd     ttsi
## 1:     1   1  1  3   1     2 10.12838  5.37544
## 2:     1   1  1  5   0     0  0.00000 31.00578
## 3:     1   1  1  8   0     1 30.09248 55.54601
## 4:     1   1  2  3   3     1  1.89316 18.92389
## 5:     1   1  2  5   0     0  0.00000 50.18351
## 6:     1   1  2  8   0     0  0.00000 10.28757</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
