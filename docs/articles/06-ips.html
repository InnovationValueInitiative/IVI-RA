<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Collaborate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/how-to-contribute.html">How to contribute</a>
    </li>
    <li>
      <a href="../articles/suggested-improvements.html">Suggested improvements</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, txseq :<span class="er">=</span><span class="st"> "Sequence 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, txseq :<span class="er">=</span><span class="st"> "Sequence 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx line tx_cycle death      age     ttd acr eular
## 1:     1   1  1     6  3    1        1     0 55.14921 17.3511   1     2
## 2:     1   1  1    12  3    1        2     0 55.64921 16.3511   1     2
## 3:     1   1  1    18  3    1        3     0 56.14921 15.3511   1     2
## 4:     1   1  1    24  3    1        4     0 56.64921 14.3511   1     2
## 5:     1   1  1    30  3    1        5     0 57.14921 13.3511   1     2
## 6:     1   1  1    36  3    1        6     0 57.64921 12.3511   1     2
##    das28 sdai cdai      haq     ttsi si yrlen  tx_cost hosp_days hosp_cost
## 1:    NA   NA   NA 1.084385 211.9451  0   0.5 22099.18 0.0593032    71.174
## 2:    NA   NA   NA 1.075694 210.9451  0   0.5 22099.18 0.0593032    71.174
## 3:    NA   NA   NA 1.067002 209.9451  0   0.5 22099.18 0.0593032    71.174
## 4:    NA   NA   NA 1.058311 208.9451  0   0.5 22099.18 0.0593032    71.174
## 5:    NA   NA   NA 1.049619 207.9451  0   0.5 22099.18 0.0593032    71.174
## 6:    NA   NA   NA 1.040928 206.9451  0   0.5 22099.18 0.0593032    71.174
##    mgmt_cost si_cost prod_loss   utility     qalys      txseq
## 1:  204.0094       0  3794.494 0.6884950 0.3442475 Sequence 1
## 2:  204.0094       0  3764.080 0.2030834 0.1015417 Sequence 1
## 3:  204.0094       0  3733.667 0.7261850 0.3630925 Sequence 1
## 4:  204.0094       0  3703.253 0.6969708 0.3484854 Sequence 1
## 5:  204.0094       0  3672.840 0.7593497 0.3796749 Sequence 1
## 6:  204.0094       0  3642.426 0.6979515 0.3489758 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw">head</span>(sim.out1.summary$means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 22.050 15.02070       1.4050       20.6450        0
## 2:     1   2 19.600 13.87515       1.2625       18.3375        0
## 3:     1   3 20.350 14.03855       1.3625       18.9875        0
## 4:     1   4 19.125 13.43400       1.2025       17.9225        0
## 5:     1   5 16.895 12.19120       1.1300       15.7650        0
## 6:     1   6 19.255 13.48187       1.0850       18.1700        0
##          dhaq   si     qalys   dqalys  tx_cost dtx_cost hosp_days
## 1: 0.07977429 0.26 12.546616 8.632709 515276.1 377467.2 16.434823
## 2: 0.30257278 0.19 10.207140 7.418030 423182.3 332911.9 24.484104
## 3: 0.03768108 0.17 11.531039 8.094933 425155.1 329374.0 21.212413
## 4: 0.07127911 0.25 10.797585 7.724271 401896.4 326944.0  9.785711
## 5: 0.02094106 0.23  9.814094 7.150358 378136.0 300729.4  6.680827
## 6: 0.19628630 0.21 10.137321 7.298314 437552.5 341305.4 13.531651
##    hosp_cost dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1: 19648.158  13050.689  8996.816   6128.729 1638.3229 1283.7740 174707.27
## 2: 28890.440  19155.312  7497.746   5307.772 1306.3002  993.7745 138494.94
## 3: 25317.938  16470.299  7758.854   5352.485  977.7749  666.7945  51089.36
## 4: 13380.530   8455.066  6819.053   4789.917 1589.7911 1192.3989 160157.26
## 5:  7125.695   4965.462  6574.614   4744.150 1158.2180  926.2127 111155.59
## 6: 15057.802   9703.420  7782.689   5449.245 1152.6909  844.2903 157213.51
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:  116295.57 397930.4  514226.0          -895.9690  0.3510074
## 2:   94061.17 358368.7  452429.9          -891.4084  0.3029092
## 3:   33960.87 351863.5  385824.4          -899.8187  0.3284524
## 4:  107582.49 341381.4  448963.9          -844.3747  0.3143696
## 5:   78769.55 311365.2  390134.8          -801.3575  0.2885875
## 6:  106177.82 357302.3  463480.2          -807.6025  0.2981017
##    dhc_cost_ann dprod_loss_ann
## 1:     16218.63       4705.967
## 2:     14704.90       3775.177
## 3:     14279.16       1361.965
## 4:     14183.82       4301.494
## 5:     12725.03       3140.935
## 6:     14605.12       4265.003</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys       haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2791458 1.0960824 22099.18  520.3321  204.0094
## 2:     1   1    12   100 0.2958758 1.0173521 21791.73  451.8275  204.0094
## 3:     1   1    18    98 0.3078880 0.9612746 20803.09  430.4626  204.0094
## 4:     1   1    24    98 0.2795214 0.9778269 20227.77  460.9262  204.0094
## 5:     1   1    30    98 0.2981958 0.9613350 19110.41  443.2287  204.0094
## 6:     1   1    36    96 0.3111989 0.9473422 17984.89  429.6606  204.0094
##      si_cost prod_loss
## 1:   0.00000  3835.424
## 2:  63.01242  3559.930
## 3: 128.59677  3363.703
## 4: 128.59677  3421.623
## 5: 192.89516  3363.915
## 6:   0.00000  3314.951</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular       ttd         ttsi
## 1:     1   1  1  3   2     0  0.000000 2.586486e+01
## 2:     1   1  1  5   0     2  6.860419 3.206330e+01
## 3:     1   1  1  8   0     1  2.024686 7.313628e+01
## 4:     1   1  1 14   0     0  0.000000 1.314643e+09
## 5:     1   1  2  3   2     2 54.408033 9.987991e+01
## 6:     1   1  3  3   0     0  0.000000 2.101061e+01</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
