<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-arms.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Collaborate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ways-to-contribute.html">Ways to contribute</a>
    </li>
    <li>
      <a href="../articles/suggested-improvements.html">Suggested improvements</a>
    </li>
    <li>
      <a href="../articles/pull-requests.html">GitHub pull requests</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">OSVP</li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA value tool expert</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-simple/">IVI-RA value tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time-period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, arm :<span class="er">=</span><span class="st"> "Arm 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, arm :<span class="er">=</span><span class="st"> "Arm 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx tx_seq tx_cycle death      age      ttd acr eular
## 1:     1   1  1     6  3      1        1     0 40.29937 17.77046   0     2
## 2:     1   1  1    12  3      1        2     0 40.79937 16.77046   0     2
## 3:     1   1  1    18  3      1        3     0 41.29937 15.77046   0     2
## 4:     1   1  1    24  3      1        4     0 41.79937 14.77046   0     2
## 5:     1   1  1    30  3      1        5     0 42.29937 13.77046   0     2
## 6:     1   1  1    36  3      1        6     0 42.79937 12.77046   0     2
##       das28     sdai     cdai       haq        ttsi si yrlen  tx_cost
## 1: 5.723349 40.34791 39.24787 0.9881767 5.001009626  0   0.5 21485.44
## 2: 5.723349 40.34791 39.24787 0.9809623 4.001009626  0   0.5 21485.44
## 3: 5.723349 40.34791 39.24787 0.9737478 3.001009626  0   0.5 21485.44
## 4: 5.723349 40.34791 39.24787 0.9665334 2.001009626  0   0.5 21485.44
## 5: 5.723349 40.34791 39.24787 0.9593189 1.001009626  0   0.5 21485.44
## 6: 5.723349 40.34791 39.24787 0.9521045 0.001009626  0   0.5 21485.44
##    hosp_days hosp_cost mgmt_cost si_cost prod_loss   utility     qalys
## 1: 0.0172258  19.74622  192.3524       0  2964.270 0.5205238 0.2602619
## 2: 0.0172258  19.74622  192.3524       0  2942.629 0.3601032 0.1800516
## 3: 0.0172258  19.74622  192.3524       0  2920.988 0.7150036 0.3575018
## 4: 0.0172258  19.74622  192.3524       0  2899.346 0.7499807 0.3749904
## 5: 0.0172258  19.74622  192.3524       0  2877.705 0.7035165 0.3517582
## 6: 0.0172258  19.74622  192.3524       0  2856.063 0.8352932 0.4176466
##      arm
## 1: Arm 1
## 2: Arm 1
## 3: Arm 1
## 4: Arm 1
## 5: Arm 1
## 6: Arm 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next therapy and <code>tx_seq</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw">head</span>(sim.out1.summary$means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 18.290 12.62641       1.0925       17.1975        0
## 2:     1   2 19.390 13.34595       1.3050       18.0850        0
## 3:     1   3 22.320 15.15950       1.3050       21.0150        0
## 4:     1   4 18.400 12.83330       1.2175       17.1825        0
## 5:     1   5 16.795 11.83250       0.8300       15.9650        0
## 6:     1   6 20.105 13.89103       1.2925       18.8125        0
##           dhaq   si     qalys   dqalys  tx_cost dtx_cost hosp_days
## 1:  0.09729017 0.19 10.469256 7.359119 340493.0 281546.2 14.033579
## 2: -0.01822257 0.15 10.957779 7.730720 407976.7 319431.9 21.286396
## 3:  0.22507175 0.26 12.115418 8.382418 473927.7 364287.9 24.265722
## 4: -0.01272953 0.21 10.336577 7.269908 391751.7 313940.8  8.917332
## 5:  0.05991976 0.16  9.335548 6.675346 350591.1 282190.3  7.336073
## 6:  0.20488210 0.27 10.628615 7.485783 419456.6 329269.4 10.360431
##    hosp_cost dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1: 19260.446  13060.981  7036.252   4857.441  973.2360  806.1709 135841.12
## 2: 27637.357  18666.102  7035.530   4842.487  787.1161  644.6478 181934.05
## 3: 31004.732  19896.625  8379.672   5691.382 1410.7620 1015.4022 118779.14
## 4: 10722.054   7234.415  6674.228   4655.019 1047.6620  870.6036  93320.44
## 5:  9503.827   6313.853  6898.060   4859.855 1091.8656  848.4663 134056.31
## 6: 10960.974   6948.916  7997.889   5525.937 1854.2197 1321.7573 184165.05
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:   89811.70 300270.7  390082.4           21.72686  0.5556869
## 2:  119104.15 343585.1  462689.2           21.50230  0.5797188
## 3:   77814.00 390891.3  468705.3           22.26731  0.5419914
## 4:   63621.24 326700.8  390322.1           21.82583  0.5519605
## 5:   92009.49 294212.5  386222.0           21.12360  0.5394083
## 6:  123543.71 343066.0  466609.8           22.10981  0.5314011
##    dhc_cost_ann dprod_loss_ann
## 1:     29008.61       7521.338
## 2:     29125.44       9056.979
## 3:     28003.10       5230.503
## 4:     29203.92       5193.209
## 5:     29578.32       8316.361
## 6:     27041.01       9382.198</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys      haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2805081 1.200300 21485.44  576.5264  192.3524
## 2:     1   1    12    98 0.2940882 1.089508 22310.42  571.9622  192.3524
## 3:     1   1    18    97 0.3137055 1.066200 21213.48  526.5256  192.3524
## 4:     1   1    24    97 0.2952959 1.053955 20850.94  521.1880  192.3524
## 5:     1   1    30    96 0.2996690 1.079793 20783.21  526.5404  192.3524
## 6:     1   1    36    92 0.3077854 1.030339 20186.44  473.8621  192.3524
##      si_cost prod_loss
## 1:  51.22295  3600.584
## 2: 156.80495  3268.237
## 3:  52.80716  3198.319
## 4:   0.00000  3161.589
## 5:  53.35724  3239.095
## 6:   0.00000  3090.747</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular       ttd         ttsi
## 1:     1   1  1  3   3     1 3.7991939 5.305415e+01
## 2:     1   1  1  5   0     0 0.0000000 3.086401e+02
## 3:     1   1  1  8   2     1 1.7586969 3.130399e+00
## 4:     1   1  1 14   0     0 0.0000000 3.523443e+09
## 5:     1   1  2  3   1     1 0.3080703 4.236044e+01
## 6:     1   1  2  5   0     0 0.0000000 2.083962e+02</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
