<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-tx-seqs.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-input-data.html">4. Generate input data</a>
    </li>
    <li>
      <a href="../articles/05-parameters.html">5. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/06-ips.html">6. Run simulation</a>
    </li>
    <li>
      <a href="../articles/07-analysis.html">7. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Collaborate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/how-to-contribute.html">How to contribute</a>
    </li>
    <li>
      <a href="../articles/suggested-improvements.html">Suggested improvements</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.thevalueinitiative.org/open-source-value-project/">OSVP</a>
    </li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li>
      <a href="../news/index.html">Release history</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Web apps
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra-expert/">IVI-RA Model Interface</a>
    </li>
    <li>
      <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">IVI-RA Value Tool</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. The simulation can either return all simulated output (i.e., a dataset of simulated outcomes for each model structure, sampled parameter set, individual, and time period) or summaries of the simulated output.</p>
<div id="complete-output" class="section level2">
<h2 class="hasAnchor">
<a href="#complete-output" class="anchor"></a>Complete output</h2>
<p>Here, we return complete simulation output for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out1[, txseq :<span class="er">=</span><span class="st"> "Sequence 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"data"</span>)
sim.out2[, txseq :<span class="er">=</span><span class="st"> "Sequence 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx line tx_cycle death      age      ttd acr eular
## 1:     1   1  1     6  3    1        1     0 38.61979 43.96791   0     1
## 2:     1   1  1    12  3    1        2     0 39.11979 42.96791   0     1
## 3:     1   1  1    18  3    1        3     0 39.61979 41.96791   0     1
## 4:     1   1  1    24  3    1        4     0 40.11979 40.96791   0     1
## 5:     1   1  1    30  3    1        5     0 40.61979 39.96791   0     1
## 6:     1   1  1    36  3    1        6     0 41.11979 38.96791   0     1
##    das28 sdai cdai      haq     ttsi si yrlen  tx_cost hosp_days hosp_cost
## 1:    NA   NA   NA 1.150642 112.8107  0   0.5 23266.84 0.2790462  240.1361
## 2:    NA   NA   NA 1.138090 111.8107  0   0.5 23266.84 0.2790462  240.1361
## 3:    NA   NA   NA 1.125537 110.8107  0   0.5 23266.84 0.2790462  240.1361
## 4:    NA   NA   NA 1.119808 109.8107  0   0.5 23266.84 0.2790462  240.1361
## 5:    NA   NA   NA 1.114079 108.8107  0   0.5 23266.84 0.2790462  240.1361
## 6:    NA   NA   NA 1.108350 107.8107  0   0.5 23266.84 0.2790462  240.1361
##    mgmt_cost si_cost prod_loss   utility      qalys      txseq
## 1:   182.706       0  4539.881 0.6401703 0.32008513 Sequence 1
## 2:   182.706       0  4490.356 0.5530017 0.27650086 Sequence 1
## 3:   182.706       0  4440.832 0.1310827 0.06554137 Sequence 1
## 4:   182.706       0  4418.227 0.5429698 0.27148489 Sequence 1
## 5:   182.706       0  4395.623 0.5650948 0.28254739 Sequence 1
## 6:   182.706       0  4373.018 0.5773707 0.28868535 Sequence 1</code></pre>
<p>The output is data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given treatment until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next line of treatment and <code>line</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>tx_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
</div>
<div id="summary-output" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-output" class="anchor"></a>Summary output</h2>
<p>One drawback of returning all simulation output is that it can place significant strains on computer memory. For example, if 200 model structures, 1,000 parameters sets, and 5,000 patients are simulated for 15 years (i.e., 30 model cycles), then the number of observations is 30 billion. The <code>sim_iviRA</code> function consequently has the option to only return summaries of simulation output.</p>
<p>In particular, by invoking the <code>output = summary</code> option, the data.table objects <code>means</code>, <code>time.means</code>, and <code>out0</code> are returned. <code>means</code> reports simulated outcomes averaged over individuals and time and <code>tmeans</code> reports simulated outcomes averaged across individuals but conditional on time. <code>out0</code> provides outcomes for the first model cycle including time to treatment discontinuation and time to a serious infection. Output is always conditional on the model structure and sampled parameter set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1.summary &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">tx_seqs =</span> txseq1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs, <span class="dt">output =</span> <span class="st">"summary"</span>)
<span class="kw">head</span>(sim.out1.summary$means)</code></pre></div>
<pre><code>##    model sim    lys     dlys lys_infusion lys_injection lys_oral
## 1:     1   1 20.290 13.99076       1.4975       18.7925        0
## 2:     1   2 21.370 14.41940       0.7800       20.5900        0
## 3:     1   3 19.015 13.25745       1.0800       17.9350        0
## 4:     1   4 16.235 11.43377       0.9525       15.2825        0
## 5:     1   5 19.255 13.21410       1.4600       17.7950        0
## 6:     1   6 18.740 13.05584       1.2650       17.4750        0
##          dhaq   si     qalys   dqalys  tx_cost dtx_cost hosp_days
## 1: 0.11383580 0.23 11.724117 8.156257 421179.3 326478.8 10.533779
## 2: 0.27278169 0.27 11.155192 7.721501 406972.0 321203.3 14.009846
## 3: 0.04308560 0.14 11.546948 8.119705 425589.1 332618.2  5.575083
## 4: 0.06739907 0.11  9.466679 6.785014 342493.9 273732.4 11.444715
## 5: 0.13892921 0.14 10.871870 7.546261 379352.8 295788.2 10.664013
## 6: 0.20280230 0.17  9.975567 7.080361 388299.3 304573.5 10.605415
##    hosp_cost dhosp_cost mgmt_cost dmgmt_cost   si_cost  dsi_cost prod_loss
## 1: 15610.055  10026.995  7414.208   5112.392 1089.9065  883.5379 183802.35
## 2: 20699.209  12639.676  7909.928   5337.221 1638.2432 1212.0999 197489.53
## 3:  7440.838   5189.608  7292.125   5084.143  669.0038  453.6273 110074.97
## 4: 13457.903   9156.762  6239.871   4394.532  548.9709  421.6086 141019.12
## 5: 15196.791   9918.328  8021.106   5504.633  708.6565  592.5464  38118.54
## 6: 13555.409   8666.428  7214.867   5026.475 1002.1466  788.5781 106916.32
##    dprod_loss dhc_cost dtot_cost yrs_since_approval dqalys_ann
## 1:  124513.96 342501.7  467015.7           22.17587  0.3276583
## 2:  127820.85 340392.3  468213.1           22.03816  0.3079812
## 3:   75400.33 343345.6  418745.9           21.70280  0.3240654
## 4:   94921.16 287705.3  382626.5           21.17195  0.2719543
## 5:   25513.72 311803.7  337317.4           22.32038  0.3006202
## 6:   72233.30 319055.0  391288.3           21.96856  0.2824939
##    dhc_cost_ann dprod_loss_ann
## 1:     14132.75       5097.137
## 2:     14032.70       5169.890
## 3:     14118.72       3039.333
## 4:     11822.60       3819.816
## 5:     12841.68       1023.175
## 6:     12993.41       2920.777</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$time.means)</code></pre></div>
<pre><code>##    model sim month alive     qalys      haq  tx_cost hosp_cost mgmt_cost
## 1:     1   1     6   100 0.2759890 1.188711 23266.84  363.6438   182.706
## 2:     1   1    12    99 0.3047460 1.083288 22314.09  307.2734   182.706
## 3:     1   1    18    97 0.3127574 1.060812 20892.33  313.2022   182.706
## 4:     1   1    24    96 0.3102740 1.045443 19372.55  304.9954   182.706
## 5:     1   1    30    96 0.3037971 1.047960 18501.98  316.9587   182.706
## 6:     1   1    36    95 0.2890689 1.049477 17645.44  314.6190   182.706
##      si_cost prod_loss
## 1:  94.77448  4690.085
## 2:   0.00000  4274.137
## 3: 146.55847  4185.457
## 4:   0.00000  4124.819
## 5:   0.00000  4134.746
## 6:  49.88130  4140.735</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim.out1.summary$out0)</code></pre></div>
<pre><code>##    model sim id tx acr eular       ttd         ttsi
## 1:     1   1  1  3   2     2  1.319556 4.123194e+00
## 2:     1   1  1  5   2     2 11.392070 3.420550e+01
## 3:     1   1  1  8   3     2  4.778084 2.270453e+02
## 4:     1   1  1 14   0     0  0.000000 2.958416e+10
## 5:     1   1  2  3   2     2  4.141148 1.668149e+01
## 6:     1   1  2  5   0     1  1.422447 2.239438e+01</code></pre>
<div>
<ul class="pager">
<li class="previous">
<a href="05-parameters.html">Previous</a>
</li>
<li class="next">
<a href="07-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#complete-output">Complete output</a></li>
      <li><a href="#summary-output">Summary output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
