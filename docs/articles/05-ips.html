<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-arms.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structures.html">3. Select model structures</a>
    </li>
    <li>
      <a href="../articles/04-parameters.html">4. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/05-ips.html">5. Run simulation</a>
    </li>
    <li>
      <a href="../articles/06-analysis.html">6. Value assessment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Collaborate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ways-to-contribute.html">Ways to contribute</a>
    </li>
    <li>
      <a href="../articles/suggested-improvements.html">Suggested improvements</a>
    </li>
    <li>
      <a href="../articles/pull-requests.html">GitHub pull requests</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">OSVP</li>
    <li>
      <a href="../model-description/model-description.pdf">Model description</a>
    </li>
    <li class="dropdown-header">Release history</li>
    <li>
      <a href="../articles/reproducibility.html">Reproducibility</a>
    </li>
    <li>
      <a href="../articles/hesim.html">hesim</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://innovationandvalueinitiative.shinyapps.io/ivi-ra/">Web app</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>Once treatment arms have been select, the model structures have been defined, and parameter values have been sampled, the IPS can be run. However, first, we must derive data inputs for the model specific to the model structure chosen.</p>
<div id="generate-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-input-data" class="anchor"></a>Generate input data</h2>
<p>Data inputs are model inputs that are fixed at baseline. Given a patient population and model structure, we can generate the required data with the function <code>get_input_data</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input.dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_input_data.html">get_input_data</a></span>(<span class="dt">patdata =</span> pop, <span class="dt">model_structures =</span> mod.structs)
<span class="kw">names</span>(input.dat)</code></pre></div>
<pre><code>##  [1] "n"           "haq0"        "age"         "male"        "das28"      
##  [6] "sdai"        "cdai"        "weight"      "prev.dmards" "x.mort"     
## [11] "x.ttd.all"   "x.ttd.eular"</code></pre>
<p>The function returns all patient characteristics needed to run the simulation (HAQ score at baseline, age, gender, DAS28, SDAI, CDAI, weight, and the number of previous DMARDs). It also stores two types of matrices of explanatory variables. First, <code>x.mort</code>, contains all patient characteristics known at baseline used to adjust mortality with a log odds ratio. By default, only the baseline HAQ score is used to adjust mortality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.dat$x.mort)</code></pre></div>
<pre><code>##           haq0
## [1,] 1.2725516
## [2,] 1.2853906
## [3,] 0.1149008
## [4,] 1.2351085
## [5,] 1.6027509
## [6,] 2.7847670</code></pre>
<p>The second set of matrices are the design matrices used to simulate time to treatment discontinuation. They include <code>x.ttd.all</code>, <code>x.ttd.da</code>, and <code>x.ttd.eular</code>. The required matrices depnd on the model structures chosen. <code>x.ttd.all</code> is required if treatment duration does not depend on disease activity or EULAR respone (i.e., pathway <strong>S1</strong>), <code>x.ttd.da</code> is required if treatment duration depends on disease activity (i.e., pathways <strong>S2-S5</strong> ), and <code>x.ttd.eular</code> is required if treatment duration depends on EULAR response (i.e., pathway <strong>S6</strong>). This matrix depends on the the model structure chosen since treatment duration depends on the pathway <strong>S1-S6</strong> used for treatment switching. In our selected model structures, <code>tx_iswitch = acr-eular-switch</code> or <code>tx_iswitch = acr-switch</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.dat$x.ttd.all)</code></pre></div>
<pre><code>##      [,1]
## [1,]    1
## [2,]    1
## [3,]    1
## [4,]    1
## [5,]    1
## [6,]    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.dat$x.ttd.eular)</code></pre></div>
<pre><code>##      [,1]
## [1,]    1
## [2,]    1
## [3,]    1
## [4,]    1
## [5,]    1
## [6,]    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input.dat$x.ttd.da</code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="simulate" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate" class="anchor"></a>Simulate</h2>
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. Here, we simulate outcomes for Arm 1 and Arm 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs)
sim.out1[, arm :<span class="er">=</span><span class="st"> "Arm 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structures =</span> mod.structs)
sim.out2[, arm :<span class="er">=</span><span class="st"> "Arm 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    model sim id month tx tx_seq tx_cycle death      age      ttd acr eular
## 1:     1   1  1     6  3      1        1     0 44.59055 17.60612   1     1
## 2:     1   1  1    12  3      1        2     0 45.09055 16.60612   1     1
## 3:     1   1  1    18  3      1        3     0 45.59055 15.60612   1     1
## 4:     1   1  1    24  3      1        4     0 46.09055 14.60612   1     1
## 5:     1   1  1    30  3      1        5     0 46.59055 13.60612   1     1
## 6:     1   1  1    36  3      1        6     0 47.09055 12.60612   1     1
##    das28 sdai cdai       haq       ttsi si yrlen  tx_cost    hosp_cost
## 1:    NA   NA   NA 0.9290903  3.8031107  0   0.5 22901.25 5.335864e-05
## 2:    NA   NA   NA 0.9275003  2.8031107  0   0.5 22901.25 5.335864e-05
## 3:    NA   NA   NA 0.9259103  1.8031107  0   0.5 22901.25 5.335864e-05
## 4:    NA   NA   NA 0.9243203  0.8031107  0   0.5 22901.25 5.335864e-05
## 5:    NA   NA   NA 0.9227303 -0.1968893  0   0.5 22901.25 5.335864e-05
## 6:    NA   NA   NA 0.9211404 -1.1968893  0   0.5 22901.25 5.335864e-05
##    mgmt_cost si_cost prod_loss   utility     qalys   arm
## 1:  190.6115       0  2320.172 0.6452355 0.3226177 Arm 1
## 2:  190.6115       0  2316.201 0.6968917 0.3484459 Arm 1
## 3:  190.6115       0  2312.231 0.7511151 0.3755575 Arm 1
## 4:  190.6115       0  2308.260 0.7022039 0.3511019 Arm 1
## 5:  190.6115       0  2304.290 0.6746919 0.3373459 Arm 1
## 6:  190.6115       0  2300.319 0.6512153 0.3256076 Arm 1</code></pre>
<p><code>sim_iviRA</code> returns a data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given model structure (<code>model</code>) and sampled parameter set (<code>sim</code>), a sampled patient (<code>id</code>) remains on a given therapy until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next therapy and <code>therapy_seq</code> increments by one. Patient age (<code>age</code>) increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>), disease activity measures (<code>das28</code>, <code>sdai</code>, and <code>cdai</code>), and <code>ttd</code> depend on the model structure chosen. For example, in the first model structure, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). The simulation returned NA values for the three disease activity measures because treatment switching is is not a function of disease activity (i.e., <strong>S6</strong> was chosen in the first model structure). The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>Health care sector costs consist of treatment costs (<code>treat_cost</code>); hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>). Non-health care sector costs are those due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>Utility (<code>utility</code>) depends on whether the Hernandez-Alava mixture model or Wailoo logistic regression equation is used to simulate utility. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
<div>
<ul class="pager">
<li class="previous">
<a href="04-parameters.html">Previous</a>
</li>
<li class="next">
<a href="06-analysis.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#generate-input-data">Generate input data</a></li>
      <li><a href="#simulate">Simulate</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
