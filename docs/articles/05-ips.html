<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the IPS â€¢ iviRA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">IVI-RA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Run the model
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00-intro.html">0. Introduction</a>
    </li>
    <li>
      <a href="../articles/01-population.html">1. Generate population</a>
    </li>
    <li>
      <a href="../articles/02-arms.html">2. Select treatment sequences</a>
    </li>
    <li>
      <a href="../articles/03-structure.html">3. Select model structure</a>
    </li>
    <li>
      <a href="../articles/04-parameters.html">4. Sample parameters</a>
    </li>
    <li>
      <a href="../articles/05-ips.html">5. Run simulation</a>
    </li>
    <li>
      <a href="../articles/06-cea.html">6. Cost-effectiveness analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/collaborate.html">Collaborate</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/IVI-RA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Run the IPS</h1>
            
          </div>

    
    
<div class="contents">
<p>Once treatment arms have been select, the model structure has been defined, and parameter values have been sampled, the IPS can be run. However, first, we must derive data inputs for the model specific to the model structure chosen.</p>
<div id="generate-input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-input-data" class="anchor"></a>Generate input data</h2>
<p>Data inputs are model inputs that are fixed at baseline. Given a patient population and model structure, we can generate the required data with the function <code>get_input_data</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input.dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_input_data.html">get_input_data</a></span>(<span class="dt">patdata =</span> pop, <span class="dt">model_structure =</span> mod.struct)
<span class="kw">names</span>(input.dat)</code></pre></div>
<pre><code>##  [1] "n"           "haq0"        "age"         "male"        "das28"      
##  [6] "sdai"        "cdai"        "weight"      "prev.dmards" "x.mort"     
## [11] "x.ttd"</code></pre>
<p>The function returns all patient characteristics needed to run the simulation (HAQ score at baseline, age, gender, DAS28, SDAI, CDAI, weight, and the number of previous DMARDs). It also stores two matrices of explanatory variables. The first matrix, <code>x.mort</code>, contains all patient characteristics known at baseline used to adjust mortality with a log odds ratio. By default, only the baseline HAQ score is used to adjust mortality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.dat$x.mort)</code></pre></div>
<pre><code>##           haq0
## [1,] 0.1430960
## [2,] 1.3716961
## [3,] 1.0643199
## [4,] 0.9628729
## [5,] 1.2583120
## [6,] 2.7052381</code></pre>
<p>The second matrix, <code>x.ttd</code>, is the design matrix used to simulate time to treatment discontinuation. This matrix depends on the the model structure chosen since treatment duration depends on the pathway <strong>S1-S6</strong> used for treatment switching. In the current model structure, <code>itreat_switch = acr-switch</code>, the design matrix is a single column of ones since the model parameters used to simulate treatment duration do not differ across patients.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(input.dat$x.ttd)</code></pre></div>
<pre><code>##      [,1]
## [1,]    1
## [2,]    1
## [3,]    1
## [4,]    1
## [5,]    1
## [6,]    1</code></pre>
</div>
<div id="simulate" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate" class="anchor"></a>Simulate</h2>
<p>We run the IPS using the function <code>sim_iviRA</code>. The main arguments are the selected treatment arms, the input data, the parameter samples, and the model structure. Here, we simulate outcomes for Arm 1 (adamtx, etnmtx, ifxmtx) and Arm 2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm1, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structure =</span> mod.struct)
sim.out1[, arm :<span class="er">=</span><span class="st"> "Arm 1"</span>]
sim.out2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim_iviRA.html">sim_iviRA</a></span>(<span class="dt">arms =</span> arm2, <span class="dt">input_data =</span> input.dat, <span class="dt">pars =</span> parsamp,
                     <span class="dt">model_structure =</span> mod.struct)
sim.out2[, arm :<span class="er">=</span><span class="st"> "Arm 2"</span>]
sim.out &lt;-<span class="st"> </span><span class="kw">rbind</span>(sim.out1, sim.out2)
<span class="kw">head</span>(sim.out)</code></pre></div>
<pre><code>##    sim id month therapy therapy_seq therapy_cycle death      age
## 1:   1  1     6       3           1             1     0 51.84709
## 2:   1  1    12       5           2             1     0 52.34709
## 3:   1  1    18       8           3             1     0 52.84709
## 4:   1  1    24       8           3             2     0 53.34709
## 5:   1  1    30       8           3             3     0 53.84709
## 6:   1  1    36      14           4             1     0 54.34709
##           ttd acr eular       haq      ttsi si yrlen infusion_cost
## 1:  0.0000000   0     0 0.1430960  22.19741  0   0.5        0.0000
## 2:  0.0000000   0     0 0.1430960  37.57499  0   0.5        0.0000
## 3:  1.7979808   3     2 0.0000000 226.12167  0   0.5      820.0000
## 4:  0.7979808   3     2 0.0000000 225.12167  0   0.5      710.6667
## 5: -0.2020192   3     2 0.6223229 224.12167  0   0.5      710.6667
## 6:         NA   0     0 0.6223229        NA  0   0.5        0.0000
##       rx_cost treat_cost  hosp_cost mgmt_cost si_cost   hc_cost prod_loss
## 1: 29710.9475 29710.9475 0.01803421  185.1829       0 29896.148  489.9882
## 2: 29715.8875 29715.8875 0.01803421  185.1829       0 29901.088  489.9882
## 3: 17541.9375 18361.9375 0.01803421  185.1829       0 18547.138    0.0000
## 4: 24963.7375 25674.4042 0.01803421  185.1829       0 25859.605    0.0000
## 5: 24963.7375 25674.4042 0.01052028  185.1829       0 25859.598 2130.9540
## 6:   842.8875   842.8875 0.01052028  185.1829       0  1028.081 2130.9540
##        pain   utility     qalys   arm
## 1: 45.19129 0.2782731 0.1391366 Arm 1
## 2: 52.03510 0.8796361 0.4398181 Arm 1
## 3: 35.17534 0.7340840 0.3670420 Arm 1
## 4: 27.53618 0.8420665 0.4210332 Arm 1
## 5: 48.13327 0.6918339 0.3459169 Arm 1
## 6: 74.04957 0.6491063 0.3245531 Arm 1</code></pre>
<p><code>sim_iviRA</code> returns a data.table which is an enhanced data.frame from the data.table package designed for fast data manipulation. For a given sampled parameter set (<code>sim</code>) a sampled patient (<code>id</code>) remains on a given therapy until time to treatment discontinuation (<code>ttd</code>) becomes less than zero in a given month. Treatment discontinuation is caused by a serious infection (<code>si = 1</code>) if the sampled time to serious infection at treatment initiation is less than the sampled time to discontinuation. After discontinuation, a patient switches to the next therapy and <code>therapy_seq</code> increments by one. Patient age increases in 6-month increments.</p>
<p>The HAQ score (<code>haq</code>) during the initial 6-month period (<code>therapy_cycle = 1</code>) and <code>ttd</code> depend on the model structure chosen. In our chosen structure, itreat_haq = acr-eular-haq and itreat_switch = acr-eular-switch, HAQ and time to treatment discontinuation depend on ACR response (<code>acr</code>) and in turn, EULAR response (<code>eular</code>). For patients on cDMARDs, the HAQ score progresses according to the LCGM while HAQ progresses linearly for patients on bDMARDs. The simulation ends when a patient dies (<code>death = 1</code>).</p>
<p>An important component of health care sector costs (<code>hc_cost</code>) are the costs associated with treatment (<code>treat_cost</code>), which consist of infusion costs (<code>infusion_cost</code>) and drug acquisition costs (<code>rx_cost</code>). Other health care sector costs are hospital costs (<code>hosp_cost</code>), which increase with the HAQ score; general management costs (<code>mgmt_cost</code>); and the costs of caused by serious infections (<code>si_cost</code>).</p>
<p>The model currently only supports non-health care sector costs due to lost wages. Analyses performed from a societal perspective should include these productivity losses (<code>prod_loss</code>).</p>
<p>If utility is simulated using the mixture model, then both pain (<code>pain</code>) and utility (<code>utility</code>) are returned. If, on the other hand, the Wailoo model is used, then only utility is returned. In both cases, QALYs (<code>qalys</code>) are calculated as a function of utility and the estimated utility loss from a serious infection.</p>
<div>
<ul class="pager">
<li class="previous">
<a href="04-parameters.html">Previous</a>
</li>
<li class="next">
<a href="06-cea.html">Next</a>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#generate-input-data">Generate input data</a></li>
      <li><a href="#simulate">Simulate</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
